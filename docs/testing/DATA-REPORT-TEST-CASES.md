# 数据报表功能测试用例文档

## 一、测试概述

### 1.1 测试目标
验证数据报表功能的正确性、稳定性和性能，确保用户能够正常查看文章生成、发布和收录等统计数据。

### 1.2 测试范围
- 后端 API 接口测试
- 前端页面功能测试
- 数据准确性验证
- 筛选器功能测试
- 图表渲染测试

### 1.3 测试环境
- 后端：Python 3.10+ / FastAPI / SQLite
- 前端：Vue 3 / TypeScript / Element Plus / ECharts
- 浏览器：Chrome 120+ / Edge 120+

---

## 二、后端 API 测试用例

### 2.1 GET /api/reports/stats - 数据总览接口

#### TC-001: 正常请求（无筛选参数）
**前置条件：** 数据库中已有文章、发布记录和收录检测数据

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送 GET 请求到 `/api/reports/stats` | 返回 HTTP 200 |
| 2 | 检查响应数据结构 | 包含所有必需字段（total_articles, publish_success_rate 等）|
| 3 | 验证数据类型 | 所有数值字段为 number，百分比为 float |

**预期响应示例：**
```json
{
  "total_articles": 150,
  "common_articles": 50,
  "geo_articles": 100,
  "publish_success_rate": 85.5,
  "publish_success_count": 120,
  "publish_total_count": 140,
  "keyword_hit_rate": 72.3,
  "keyword_hit_count": 80,
  "keyword_check_count": 110,
  "company_hit_rate": 65.8,
  "company_hit_count": 73,
  "company_check_count": 110
}
```

#### TC-002: 按项目筛选
**前置条件：** 数据库中存在多个项目的数据

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送 GET 请求 `/api/reports/stats?project_id=1&days=7` | 返回 HTTP 200 |
| 2 | 验证返回数据 | 仅包含 project_id=1 的文章和发布记录 |
| 3 | 验证时间范围 | 仅包含最近7天的数据 |

#### TC-003: 时间范围筛选
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 请求 `/api/reports/stats?days=30` | 返回近30天数据 |
| 2 | 请求 `/api/reports/stats?days=7` | 返回近7天数据 |
| 3 | 验证数据量 | 30天数据量 >= 7天数据量 |

#### TC-004: 空数据情况
**前置条件：** 数据库为空或筛选条件下无数据

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 请求接口 | 返回 HTTP 200 |
| 2 | 检查响应 | 所有计数为0，所有百分比为0 |

### 2.2 GET /api/reports/platform-comparison - 平台对比接口

#### TC-005: 正常请求
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | GET `/api/reports/platform-comparison` | 返回 HTTP 200 |
| 2 | 检查数据结构 | 返回数组，每个元素包含 platform, hit_count, total_count, hit_rate |

**预期响应示例：**
```json
[
  { "platform": "豆包", "hit_count": 45, "total_count": 60, "hit_rate": 75.0 },
  { "platform": "DeepSeek", "hit_count": 30, "total_count": 50, "hit_rate": 60.0 },
  { "platform": "通义千问", "hit_count": 35, "total_count": 55, "hit_rate": 63.64 }
]
```

### 2.3 GET /api/reports/project-leaderboard - 项目排行接口

#### TC-006: 正常请求
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | GET `/api/reports/project-leaderboard` | 返回 HTTP 200 |
| 2 | 验证返回数据 | 按 ai_mention_rate 降序排列 |
| 3 | 验证字段 | 包含 rank, project_name, company_name 等 |

### 2.4 GET /api/reports/content-analysis - 内容分析接口

#### TC-007: 正常请求
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | GET `/api/reports/content-analysis` | 返回 HTTP 200 |
| 2 | 验证返回数据 | 返回已发布文章列表，按创建时间降序 |
| 3 | 验证字段 | 包含 title, platform, ai_contribution 等 |

---

## 三、前端功能测试用例

### 3.1 页面加载测试

#### TC-008: 正常加载
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 访问 `/data-report` 页面 | 页面正常加载，无白屏 |
| 2 | 观察页面结构 | 显示筛选区、4张卡片、图表、2个表格 |
| 3 | 检查控制台 | 无报错信息 |

#### TC-009: 侧边栏导航
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击侧边栏 "数据报表" 菜单 | 正确跳转到数据报表页面 |
| 2 | 观察菜单高亮 | "数据报表" 菜单项高亮显示 |

### 3.2 筛选器功能测试

#### TC-010: 项目选择器
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击项目下拉框 | 显示所有项目列表 |
| 2 | 选择一个项目 | 卡片数据和表格数据刷新 |
| 3 | 清除选择 | 显示所有项目的数据 |

#### TC-011: 时间范围切换
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 选择 "近7天" | 显示最近7天的统计数据 |
| 2 | 选择 "近30天" | 显示最近30天的统计数据，数据量 >= 近7天 |

#### TC-012: 平台筛选
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 选择 "全平台" | 显示所有平台数据 |
| 2 | 选择 "DeepSeek" | 图表和表格只显示 DeepSeek 平台数据 |
| 3 | 选择 "豆包" | 图表和表格只显示 豆包 平台数据 |

#### TC-013: 刷新按钮
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击刷新按钮 | 所有数据重新加载，显示 loading 状态 |
| 2 | 检查数据更新时间 | 数据应该是最新的 |

### 3.3 卡片数据展示测试

#### TC-014: 文章生成数卡片（蓝色）
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 观察卡片显示 | 显示总文章数，以及普通/GEO细分 |
| 2 | 验证数据准确性 | 数字应该等于筛选条件下实际文章数 |
| 3 | 检查样式 | 蓝色渐变背景，白色文字 |

#### TC-015: 发布成功率卡片（绿色）
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 观察卡片显示 | 显示百分比，以及成功/总数 |
| 2 | 验证计算准确性 | 成功率 = 成功数 / 总数 * 100% |
| 3 | 检查样式 | 绿色渐变背景 |

#### TC-016: 关键词命中率卡片（橙色）
| 检查项 | 预期结果 |
|--------|----------|
| 显示命中率百分比 | ✓ |
| 显示命中/检测数 | ✓ |
| 橙色渐变样式 | ✓ |

#### TC-017: 公司名命中率卡片（灰色）
| 检查项 | 预期结果 |
|--------|----------|
| 显示命中率百分比 | ✓ |
| 显示命中/检测数 | ✓ |
| 灰色渐变样式 | ✓ |

### 3.4 图表功能测试

#### TC-018: AI平台对比分析图
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 观察图表 | 显示柱状图，每个平台一个柱子 |
| 2 | 检查数据标签 | 柱子高度对应命中率百分比 |
| 3 | 悬停查看 | 鼠标悬停显示详细数据提示框 |
| 4 | 筛选测试 | 切换平台筛选，图表数据相应更新 |

#### TC-019: 图表响应式
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 调整浏览器窗口大小 | 图表自动重绘，保持比例 |
| 2 | 切换侧边栏展开/收起 | 图表宽度自适应调整 |

### 3.5 表格功能测试

#### TC-020: 项目影响力排行榜
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 观察表格 | 显示排名、品牌/项目、公司等列 |
| 2 | 检查排序 | 按 AI 提及率降序排列 |
| 3 | 空数据测试 | 无数据时显示"暂无数据" |
| 4 | 分页检查 | 数据量大时显示分页器（如适用） |

#### TC-021: 高贡献内容分析表
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 观察表格 | 显示排名、文章标题、平台等列 |
| 2 | 检查数据 | AI 引用贡献率显示为百分比 |
| 3 | 时间格式 | 发布时间显示为 YYYY-MM-DD HH:mm 格式 |
| 4 | 空数据测试 | 无数据时显示"暂无数据" |

### 3.6 数据准确性测试

#### TC-022: 数据一致性验证
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 对比后端数据 | 前端显示的数字与后端返回一致 |
| 2 | 计算验证 | 百分比计算正确（如 命中率 = 命中数/总数） |
| 3 | 筛选一致性 | 切换筛选条件后，所有数据同步更新 |

---

## 四、性能测试用例

### 4.1 页面加载性能

#### TC-023: 首次加载时间
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 清除缓存后访问页面 | 首屏加载时间 <= 3秒 |
| 2 | 检查资源加载 | JS/CSS 文件正确加载，无 404 |

#### TC-024: 数据加载性能
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 观察 API 请求 | 所有报表接口响应时间 <= 500ms |
| 2 | 大数据量测试 | 30天数据量下，接口响应 <= 1秒 |

### 4.2 图表渲染性能

#### TC-025: 图表渲染流畅度
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 切换筛选条件 | 图表重绘流畅，无卡顿 |
| 2 | 快速切换 | 连续切换 5 次筛选，无内存泄漏 |

---

## 五、兼容性测试用例

### 5.1 浏览器兼容性

#### TC-026: 主流浏览器测试
| 浏览器 | 版本 | 预期结果 |
|--------|------|----------|
| Chrome | 120+ | ✓ 功能正常 |
| Edge | 120+ | ✓ 功能正常 |
| Firefox | 120+ | ✓ 功能正常 |
| Safari | 17+ | ✓ 功能正常（如适用） |

### 5.2 分辨率兼容性

#### TC-027: 响应式布局测试
| 分辨率 | 设备类型 | 预期结果 |
|--------|----------|----------|
| 1920x1080 | 桌面显示器 | ✓ 正常显示，4列卡片布局 |
| 1366x768 | 笔记本 | ✓ 正常显示，自适应布局 |
| 1440x900 | 笔记本 | ✓ 正常显示 |

---

## 六、安全测试用例

### 6.1 输入验证

#### TC-028: 参数合法性验证
| 测试项 | 输入 | 预期结果 |
|--------|------|----------|
| days 参数 | -1 | 返回 400 错误，提示参数无效 |
| days 参数 | 0 | 返回 400 错误 |
| days 参数 | 999999 | 返回 400 错误或自动限制为最大值 |
| project_id | 不存在ID | 返回空数据或 404 |
| project_id | abc | 返回 400 错误，要求整数 |

### 6.2 SQL 注入防护

#### TC-029: SQL 注入测试
| 测试项 | 输入 | 预期结果 |
|--------|------|----------|
| project_id | `1 OR 1=1` | 安全处理，不返回额外数据 |
| project_id | `1; DROP TABLE articles--` | 安全处理，表不被删除 |

---

## 七、测试执行计划

### 7.1 测试阶段划分

| 阶段 | 测试内容 | 预计时间 |
|------|----------|----------|
| 冒烟测试 | TC-001, TC-008, TC-014 | 30分钟 |
| 功能测试 | TC-001 ~ TC-022 | 4小时 |
| 性能测试 | TC-023 ~ TC-025 | 2小时 |
| 兼容性测试 | TC-026 ~ TC-027 | 2小时 |
| 安全测试 | TC-028 ~ TC-029 | 1小时 |

### 7.2 缺陷严重等级定义

| 等级 | 定义 | 示例 |
|------|------|------|
| P0-致命 | 功能完全不可用，阻塞测试 | 页面白屏、API 500错误 |
| P1-严重 | 主要功能异常，影响使用 | 数据显示错误、筛选失效 |
| P2-一般 | 次要功能异常 | 样式错位、提示信息不清 |
| P3-轻微 | 界面优化建议 | 颜色微调、间距调整 |

### 7.3 通过标准

- 所有 P0、P1 缺陷已修复并通过回归测试
- 功能测试用例通过率 >= 95%
- 性能测试指标全部达标
- 安全测试无高危漏洞

---

## 八、附录

### 8.1 自动化测试建议

以下测试用例适合自动化：
- TC-001 ~ TC-004：API 基础功能
- TC-014 ~ TC-017：卡片数据展示
- TC-028：参数验证

推荐使用工具：
- API 测试：Postman / pytest
- UI 测试：Playwright / Cypress

### 8.2 测试数据准备

```sql
-- 准备测试数据脚本（示例）
-- 插入测试项目
INSERT INTO projects (name, company_name, status) VALUES 
('测试项目A', '测试公司A', 1),
('测试项目B', '测试公司B', 1);

-- 插入测试文章
INSERT INTO geo_articles (keyword_id, title, content, publish_status, created_at) VALUES
(1, '测试文章1', '内容...', 'published', datetime('now')),
(1, '测试文章2', '内容...', 'draft', datetime('now'));

-- 插入收录检测记录
INSERT INTO index_check_records (keyword_id, platform, question, keyword_found, company_found, check_time) VALUES
(1, '豆包', '测试问题', 1, 1, datetime('now')),
(1, 'DeepSeek', '测试问题', 0, 1, datetime('now'));
```

### 8.3 相关文档链接

- [需求规格说明书]（如有）
- [接口文档]（如 Swagger UI）
- [前端组件文档]（如 Element Plus）

---

**文档版本：** v1.0  
**编写日期：** 2026-02-03  
**编写人：** 测试工程师  
**审核状态：** 待审核
